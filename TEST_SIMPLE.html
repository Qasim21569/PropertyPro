<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PropertyPro - Simple Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin: 15px 0;
        }
        input, button {
            padding: 10px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
            border: none;
        }
        button:hover {
            background-color: #0056b3;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .property-card {
            border: 1px solid #eee;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            background: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè† PropertyPro - Firebase Test</h1>
        
        <div id="status">
            <h3>Connection Status:</h3>
            <p id="firebase-status">‚è≥ Connecting to Firebase...</p>
        </div>

        <div id="auth-section">
            <h2>Authentication Test</h2>
            <div class="form-group">
                <input type="email" id="email" placeholder="Enter email">
            </div>
            <div class="form-group">
                <input type="password" id="password" placeholder="Enter password">
            </div>
            <div class="form-group">
                <button onclick="signUp()">Sign Up</button>
                <button onclick="signIn()">Sign In</button>
                <button onclick="signOut()">Sign Out</button>
            </div>
            <div id="auth-result"></div>
        </div>

        <div id="property-section" style="display: none;">
            <h2>Property Management Test</h2>
            <div class="form-group">
                <input type="text" id="propertyName" placeholder="Property Name">
            </div>
            <div class="form-group">
                <input type="number" id="propertyPrice" placeholder="Price">
            </div>
            <div class="form-group">
                <input type="text" id="propertyCity" placeholder="City">
            </div>
            <div class="form-group">
                <button onclick="addProperty()">Add Property</button>
                <button onclick="loadProperties()">Load Properties</button>
            </div>
            <div id="properties-list"></div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut as firebaseSignOut,
            onAuthStateChanged 
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            getDocs, 
            doc, 
            setDoc 
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBbYV1Lv5V2SsxXFM1FaGlzj8lpxhKi_mE",
            authDomain: "propertypro-39565.firebaseapp.com",
            projectId: "propertypro-39565",
            storageBucket: "propertypro-39565.firebasestorage.app",
            messagingSenderId: "408555647727",
            appId: "1:408555647727:web:b38758863f621d11fd611a",
            measurementId: "G-5X4Y4LM7DH"
        };

        // Initialize Firebase
        let app, auth, db, currentUser = null;

        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            
            document.getElementById('firebase-status').innerHTML = '‚úÖ <span class="success">Connected to Firebase successfully!</span>';
            
            // Listen for auth changes
            onAuthStateChanged(auth, (user) => {
                currentUser = user;
                if (user) {
                    document.getElementById('auth-result').innerHTML = `‚úÖ <span class="success">Signed in as: ${user.email}</span>`;
                    document.getElementById('property-section').style.display = 'block';
                } else {
                    document.getElementById('auth-result').innerHTML = '';
                    document.getElementById('property-section').style.display = 'none';
                }
            });
            
        } catch (error) {
            document.getElementById('firebase-status').innerHTML = `‚ùå <span class="error">Firebase connection failed: ${error.message}</span>`;
        }

        // Global functions for buttons
        window.signUp = async () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                document.getElementById('auth-result').innerHTML = '<span class="error">Please enter email and password</span>';
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                
                // Create user profile in Firestore
                await setDoc(doc(db, "users", userCredential.user.uid), {
                    email: userCredential.user.email,
                    role: "owner",
                    createdAt: new Date()
                });
                
                document.getElementById('auth-result').innerHTML = '<span class="success">Account created successfully!</span>';
            } catch (error) {
                document.getElementById('auth-result').innerHTML = `<span class="error">Sign up failed: ${error.message}</span>`;
            }
        };

        window.signIn = async () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                document.getElementById('auth-result').innerHTML = '<span class="error">Please enter email and password</span>';
                return;
            }

            try {
                await signInWithEmailAndPassword(auth, email, password);
                document.getElementById('auth-result').innerHTML = '<span class="success">Signed in successfully!</span>';
            } catch (error) {
                document.getElementById('auth-result').innerHTML = `<span class="error">Sign in failed: ${error.message}</span>`;
            }
        };

        window.signOut = async () => {
            try {
                await firebaseSignOut(auth);
                document.getElementById('auth-result').innerHTML = '<span class="success">Signed out successfully!</span>';
                document.getElementById('properties-list').innerHTML = '';
            } catch (error) {
                document.getElementById('auth-result').innerHTML = `<span class="error">Sign out failed: ${error.message}</span>`;
            }
        };

        window.addProperty = async () => {
            if (!currentUser) {
                alert('Please sign in first!');
                return;
            }

            const name = document.getElementById('propertyName').value;
            const price = document.getElementById('propertyPrice').value;
            const city = document.getElementById('propertyCity').value;

            if (!name || !price || !city) {
                alert('Please fill all property fields!');
                return;
            }

            try {
                await addDoc(collection(db, 'properties'), {
                    title: name,
                    price: parseInt(price),
                    city: city,
                    ownerId: currentUser.uid,
                    ownerEmail: currentUser.email,
                    createdAt: new Date()
                });

                document.getElementById('propertyName').value = '';
                document.getElementById('propertyPrice').value = '';
                document.getElementById('propertyCity').value = '';
                
                alert('Property added successfully!');
                loadProperties();
            } catch (error) {
                alert('Error adding property: ' + error.message);
            }
        };

        window.loadProperties = async () => {
            if (!currentUser) {
                alert('Please sign in first!');
                return;
            }

            try {
                const querySnapshot = await getDocs(collection(db, 'properties'));
                let propertiesHtml = '<h3>All Properties:</h3>';
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    propertiesHtml += `
                        <div class="property-card">
                            <strong>${data.title}</strong><br>
                            Price: $${data.price?.toLocaleString()}<br>
                            City: ${data.city}<br>
                            Owner: ${data.ownerEmail}<br>
                            <small>Added: ${data.createdAt?.toDate?.()?.toLocaleDateString() || 'Recently'}</small>
                        </div>
                    `;
                });
                
                document.getElementById('properties-list').innerHTML = propertiesHtml;
            } catch (error) {
                alert('Error loading properties: ' + error.message);
            }
        };
    </script>
</body>
</html>

